@page "/Modules/Index"
@attribute [Authorize(Policy = "User")]

@inject IStringLocalizer<App> Localizer
@inject IModuleService ModuleService

<h1><span class="fa fa-boxes" aria-hidden="true"/>@Localizer["Modules"]</h1>

<ModulesList Modules="Modules" MayEdit="MayEdit" Principal="Principal"/>

@code {
    [CascadingParameter] private Task<AuthenticationState>? authenticationStateTask { get; set; }

    ClaimsPrincipal? Principal;
    IEnumerable<Module>? Modules;

    protected override async Task OnParametersSetAsync()
    {
        Principal = await authenticationStateTask.GetClaimsPrincipalAsync();
        Modules = await ModuleService.GetAllAsync(Principal);
    }

    private bool MayEdit => Principal is not null;
}
