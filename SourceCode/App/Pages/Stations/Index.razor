@page "/Stations/Index"

@inject IStringLocalizer<App> Localizer

@inject StationService StationService
@inject ModuleService ModuleService

<h1><span class="@FontAwesome.Station" aria-hidden="true" /> @Localizer["Stations"] </h1>

<StationsList Stations="Stations" MayEdit="MayEdit" AnyModules="AnyModules"/>

@code {
    [CascadingParameter] private Task<AuthenticationState>? authenticationStateTask { get; set; }

    ClaimsPrincipal? Principal;
    IEnumerable<Station>? Stations;
    bool AnyModules;

    protected override async Task OnParametersSetAsync()
    {
        Principal = await authenticationStateTask.GetClaimsPrincipalAsync();
        Stations = await StationService.GetAllAsync(Principal);
        AnyModules = await ModuleService.HasAnyNonStationAsync(Principal, Principal.AsModuleOwnershipRef());
    }

    private bool MayEdit => Principal is not null;
}

