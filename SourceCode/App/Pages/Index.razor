@page "/"
@inject NavigationManager Navigator
@inject IStringLocalizer<App> Localizer
@using System.Security.Claims

<AuthorizeView>
    <Authorized>
        <ContentView Href="https://raw.githubusercontent.com/tellurianinteractive/Tellurian.Trains.ModulesRegistryApp/master/RELEASENOTES.md"></ContentView>
    </Authorized>
    <Authorizing>
        <h1>@Localizer["Welcome"]</h1>
        @Localizer["AuthenticationInProgress"]
    </Authorizing>
    <NotAuthorized>
        <h1>@Localizer["Welcome"]</h1>
        @if (Principal?.Identity?.IsAuthenticated == true)
        {
            <ContentView ContentName="HomeNoUser"></ContentView>
        }
        else
        {
            <ContentView ContentName="HomeNotAuthorized"></ContentView>
        }
    </NotAuthorized>
</AuthorizeView>

@code {
    [CascadingParameter] private Task<AuthenticationState>? authenticationStateTask { get; set; }
    private ClaimsPrincipal? Principal;

    protected async override Task OnParametersSetAsync()
    {
        Principal = await authenticationStateTask.GetClaimsPrincipalAsync();
        if (!Principal.IsLatestTermsOfUseAccepted())
        {
            Navigator.NavigateTo("/TermsOfUse");
        }
    }

}