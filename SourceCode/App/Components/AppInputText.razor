@using System.Linq.Expressions;
@using System.Diagnostics.CodeAnalysis;

@inherits InputBase<string>
@inject IStringLocalizer<App> Localizer

<div class="@BootstrapWrapperCss">
    @if (!string.IsNullOrWhiteSpace(Label))
    {
        <label class="form-control-label" for="@Label">@Localizer[Label]</label>
    }
    @if (IsDisabled)
    {
        <input disabled type="@Type" class="form-control @CssClass" id="@Label" @bind="@CurrentValue" placeholder="@PlaceholderText" />
    }
    else
    {
        <input type="@Type" class="form-control @CssClass" id="@Label" @bind="@CurrentValue" placeholder="@PlaceholderText" />
    }
    @if (ValidationFor is not null)
    {
        <div class="form-control-validation">
            <ValidationMessage For="@ValidationFor" />
        </div>
    }
</div>

@code {
    [Parameter] public string? Label { get; set; }
    [Parameter] public Expression<Func<string>>? ValidationFor { get; set; }
    [Parameter] public int? Width { get; set; }
    [Parameter] public string? Placeholder { get; set; }
    [Parameter] public string? InputType { get; set; }
    [Parameter] public bool IsDisabled { get; set; }

    protected override bool TryParseValueFromString(string? value, [MaybeNullWhen(false)] out string result, [NotNullWhen(false)] out string? validationErrorMessage)
    {
        result = value ?? string.Empty;
        validationErrorMessage = null;
        return true;
    }

    string BootstrapWrapperCss => Width.HasValue ? $"col-md-{Width}" : "col-md-4";
    string Type => string.IsNullOrWhiteSpace(InputType) ? "text" : InputType.ToLowerInvariant();
    string PlaceholderText => string.IsNullOrWhiteSpace(Placeholder) ? string.Empty : Localizer[Placeholder].Value;
    string Disabled => IsDisabled ? "disabled" : string.Empty;
}